define(['jquery','Magento_Catalog/js/price-utils','underscore'],function($,utils,_){'use strict';var priceUpdater={calculateSelectedOptionsPrice:function(){var self=this,form=this.base.getFormElement(),config=this.base.options,options=$(config.optionsSelector,form),processedDatetimeOptions=[];this.optionFinalPrice=0;this.optionBasePrice=0;this.optionOldPriceInclTax=0;this.optionOldPriceExclTax=0;this.optionFinalPricePerItem=0;this.optionBasePricePerItem=0;this.optionOldPricePerItemInclTax=0;this.optionOldPricePerItemExclTax=0;options.filter('select').each(function(index,element){var $element=$(element),optionId=utils.findOptionId($element),optionConfig=config.optionConfig&&config.optionConfig[optionId],values=$element.val();if(_.isUndefined(values)||!values){return;}
if(!Array.isArray(values)){values=[values];}
$(values).each(function(i,valueId){if(_.isUndefined(optionConfig[valueId])){if(_.isUndefined(optionConfig.prices)){return;}
var dateDropdowns=$element.parent().find(config.dateDropdownsSelector);if(_.isUndefined(dateDropdowns)){return;}
if($element.closest('.field').css('display')=='none'){$element.val('');return;}
var optionConfigCurrent=self.base.getDateDropdownConfig(optionConfig,dateDropdowns);if(_.isUndefined(optionConfigCurrent.prices)||$.inArray(optionId,processedDatetimeOptions)!=-1){return;}
processedDatetimeOptions.push(optionId);}else{var optionConfigCurrent=optionConfig[valueId];}
self.collectOptionPriceAndQty(optionConfigCurrent,optionId,valueId);});});options.filter('input[type="radio"]').each(function(index,element){var $element=$(element),optionId=utils.findOptionId($element),optionConfig=config.optionConfig&&config.optionConfig[optionId],valueId=$element.val();if(typeof valueId=='undefined'||!valueId){return;}
var optionConfigCurrent=optionConfig[valueId];self.collectOptionPriceAndQty(optionConfigCurrent,optionId,valueId);});options.filter('input[type="text"], textarea, input[type="file"]').each(function(index,element){var $element=$(element),optionId=utils.findOptionId($element),optionConfig=config.optionConfig&&config.optionConfig[optionId],value=$element.val();if(typeof value=='undefined'||!value){if($('#delete-options_'+optionId+'_file').length<1){return;}}
if($element.closest('.field').css('display')=='none'){$element.val('');return;}
var isOneTime=self.base.isOneTimeOption(optionId),productQty=1;if(!isOneTime){productQty=$(config.productQtySelector).val();}
self.optionFinalPrice+=parseFloat(optionConfig.prices.finalPrice.amount)*productQty;self.optionOldPriceInclTax+=parseFloat(optionConfig.prices.oldPrice.amount_incl_tax)*productQty;self.optionBasePrice+=parseFloat(optionConfig.prices.basePrice.amount)*productQty;self.optionOldPriceExclTax+=parseFloat(optionConfig.prices.oldPrice.amount_excl_tax)*productQty;self.optionFinalPricePerItem+=parseFloat(optionConfig.prices.finalPrice.amount);self.optionOldPricePerItemInclTax+=parseFloat(optionConfig.prices.oldPrice.amount_incl_tax);self.optionBasePricePerItem+=parseFloat(optionConfig.prices.basePrice.amount);self.optionOldPricePerItemExclTax+=parseFloat(optionConfig.prices.oldPrice.amount_excl_tax);});},};return function(targetWidget){$.widget('mageworx.optionFeatures',targetWidget,priceUpdater);return $.mageworx.optionFeatures;};});