define(['jquery','jquery/ui'],function($){return{candidates:{},addCandidate:function(image,sortOrder){this.candidates[sortOrder]=image;},removeCandidate:function(sortOrder){if(typeof this.candidates[sortOrder]=='undefined'){return;}
delete this.candidates[sortOrder];},getCandidates:function(){return this.candidates;},getLastCandidate:function(){var lastCandidate,prevKey=0;for(var key in this.candidates){if(!this.candidates.hasOwnProperty(key)){continue;}
if(prevKey<key){lastCandidate=this.candidates[key];}
prevKey=key;}
return lastCandidate;},replace:function(){var image=this.getLastCandidate(),self=this,gallery,galleryCurrentImages;if(!image||typeof image=='undefined'){return;}
$.when(self.waitLoadGallery()).then(function(result){galleryCurrentImages=result.returnCurrentImages();self.fillImageWithDefaultData(image);galleryCurrentImages.forEach(function(e,i){if(typeof e.is_custom!='undefined'&&e.is_custom==1){galleryCurrentImages.splice(i,1);return;}
if(e.isMain==true){e.isMain=false;e.position+=1;}});galleryCurrentImages.unshift(image);result.updateData(galleryCurrentImages);result.first();},function(error){console.log(error);});},forceRefresh:function(){var image=this.getLastCandidate(),self=this,gallery,galleryCurrentImages;$.when(self.waitLoadGallery()).then(function(result){galleryCurrentImages=result.returnCurrentImages();galleryCurrentImages.forEach(function(e,i){if(typeof e.is_custom!='undefined'&&e.is_custom==1){galleryCurrentImages.splice(i,1);return;}
if(image&&e.isMain==true){e.isMain=false;e.position+=1;}});if(image){self.fillImageWithDefaultData(image);galleryCurrentImages.unshift(image);}
result.updateData(galleryCurrentImages);},function(error){console.log(error);});},fillImageWithDefaultData:function(image){image.caption=image.label;image.i=1;image.isMain=true;image.position=1;image.is_custom=1;return image;},waitLoadGallery:function(){var dfd=$.Deferred();var timer=setInterval(function(){gallery=$('[data-gallery-role=gallery-placeholder]').data('gallery');if(typeof gallery!='undefined'){clearInterval(timer);dfd.resolve(gallery);}},500);return dfd.promise();}}});