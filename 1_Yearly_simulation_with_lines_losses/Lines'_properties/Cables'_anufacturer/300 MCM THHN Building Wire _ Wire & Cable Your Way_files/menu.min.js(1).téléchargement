define(['jquery','mage/menu'],function($){'use strict';$.widget('Magento_Theme.menu',$.mage.menu,{_create:function(){this._super();this._on(this.document,{touchend:function(event){if(!$(event.target).closest(".ui-menu").length){this.element.trigger('mouseleave');this.tappedOutside=true;}
this.mouseHandled=false;}});var submenus=$('.submenu');submenus.filter(function(){return $(this).find('>li').length>=10}).addClass("two-columns");},_toggleMobileMode:function(){var subMenus;$(this.element).off('mouseenter mouseleave');this._on({'click .ui-menu-item:has(a)':function(event){var target=$(event.target).closest('.ui-menu-item');if(target.find('> a').length){event.preventDefault();if(!this.mouseHandled&&target.not('.ui-state-disabled').length){this.select(event);if(!event.isPropagationStopped()){this.mouseHandled=true;}
if(target.has('.ui-menu').length){this.expand(event);}else if(!this.element.is(':focus')&&$(this.document[0].activeElement).closest('.ui-menu').length){this.element.trigger('focus',[true]);if(this.active&&this.active.parents('.ui-menu').length===1){clearTimeout(this.timer);}}}
if(!target.hasClass('parent')){window.location.href=target.find('> a').attr('href');}}else{this.active=target;}}});subMenus=this.element.find('.ui-menu-item');$.each(subMenus,$.proxy(function(index,item){var category=$(item).find('> a span').not('.ui-menu-icon').text(),categoryUrl=$(item).find('> a').attr('href'),menu=$(item).find('> .ui-menu');this.categoryLink=$('<a>').attr('href',categoryUrl).text($.mage.__('All ')+category);this.categoryParent=$('<li>').addClass('ui-menu-item all-category').html(this.categoryLink);if(menu.find('.all-category').length===0){menu.prepend(this.categoryParent);}},this));},_toggleDesktopMode:function(){var categoryParent,html;this._close(this.element);this._on({'mousedown .ui-menu-item > a':function(event){event.preventDefault();},'click .ui-state-disabled > a':function(event){event.preventDefault();},'click .ui-menu-item:has(a)':function(event){if(this.tappedOutside){event.preventDefault();$(event.currentTarget).trigger('mouseenter');this.tappedOutside=false;}},'mouseenter .ui-menu-item':function(event){var target=$(event.currentTarget),submenu=this.options.menus,ulElement,ulElementWidth,width,targetPageX,rightBound;if(target.has(submenu)){ulElement=target.find(submenu);ulElementWidth=ulElement.outerWidth(true);width=target.outerWidth();targetPageX=target.offset().left;rightBound=$(window).width();if(ulElementWidth+width+targetPageX>rightBound){ulElement.addClass('submenu-reverse');}
if(targetPageX-ulElementWidth<0){ulElement.removeClass('submenu-reverse');}}
target.siblings().children('.ui-state-active').removeClass('ui-state-active');this.focus(event,target);},'mouseleave':function(event){this.collapseAll(event,true);}});categoryParent=this.element.find('.all-category');html=$('html');categoryParent.remove();if(html.hasClass('nav-open')){html.removeClass('nav-open');setTimeout(function(){html.removeClass('nav-before-open');},this.options.hideDelay);}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){if($(event.currentTarget)[0]==$('.navigation > .ui-menu')[0]){this._trigger('blur',event,{item:null});}
return;}
this.active.children('a').removeClass('ui-state-focus');this.active=null;this._trigger('blur',event,{item:this.active});},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);submenu.show().removeAttr('aria-hidden').attr('aria-expanded','true').position(position);},collapseSubmenu:function(event){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=$(event&&event.target).closest('.ui-menu-item');if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this.activeMenu=currentMenu;},this.delay);},expand:function(event){var submenu=this.active.children('.submenu');if(submenu.attr('aria-expanded')!='true'){this._open(submenu);var newItem=submenu.children('.ui-menu-item').first();this._delay(function(){this.focus(event,newItem);});}},select:function(event){this.active=$(event.target).closest('.ui-menu-item');var ui={item:this.active};if(this.active.children('[aria-expanded="true"]').length){this.collapseSubmenu(event);}
this._trigger('select',event,ui);}});return $.Magento_Theme.menu;});