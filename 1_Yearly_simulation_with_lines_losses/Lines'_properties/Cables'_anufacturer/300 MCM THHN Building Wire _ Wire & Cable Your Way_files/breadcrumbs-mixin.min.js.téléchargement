define(['jquery','Magento_Theme/js/model/breadcrumb-list','mage/template','text!Magento_Theme/templates/breadcrumbs.html','mage/cookies'],function($,breadcrumbList,mageTemplate,tpl){'use strict';return function(widget){$.widget('mage.breadcrumbs',widget,{options:{product:'',availablePaths:{},defaultPathKey:null,displayAllPaths:false,forceShowFullPath:false,hideHomeCrumb:false,hideDuplicates:false,lastCategoryCookie:null},addedNames:[],_render:function(){if(this.options.displayAllPaths){this._renderAll();}else{this._appendCatalogCrumbs();this._super();}
if(this.options.hideHomeCrumb){$(this.element).find('.item.home').remove();}},_renderAll:function(){var self=this,html='',template=mageTemplate(tpl),addedNames=[];$.each(this.options.availablePaths,function(pathId,path){var pathCrumbs=[{name:'home',label:$.mage.__('Home'),title:$.mage.__('Go to Home Page'),link:BASE_URL||''}];path.forEach(function(crumbInfo){pathCrumbs.push(crumbInfo);});self._decorate(pathCrumbs);html+=template({'breadcrumbs':pathCrumbs});});if(html.length){$(this.element).html(html);}},_appendCatalogCrumbs:function(){var lastCategoryId=3,availablePaths=this.options.availablePaths,pathKey=this.options.defaultPathKey,lastVisitedPathKey;if(!this.options.forceShowFullPath&&(lastVisitedPathKey=$.mage.cookies.get(this.options.lastCategoryCookie))){if(lastVisitedPathKey.indexOf('search--')===0){var searchQuery=lastVisitedPathKey.replace('search--','');breadcrumbList.push({'name':'search','label':$.mage.__("Search results for: '%1'").replace('%1',searchQuery),'link':'/catalogsearch/result/index/?q='+searchQuery,'title':''});pathKey=false;}else if(typeof availablePaths[lastVisitedPathKey]!=='undefined'){pathKey=lastVisitedPathKey;}}
if(pathKey&&typeof availablePaths[pathKey]!=='undefined'){availablePaths[pathKey].forEach(function(crumbInfo){breadcrumbList.push(crumbInfo);});}
if(this.options.product){breadcrumbList.push(this._getProductCrumb());}},_getProductCrumb:function(){return{'name':'product','label':this.options.product,'link':'','title':''};},_decorate:function(list){this._super(list);var self=this;if(this.options.hideDuplicates){list.forEach(function(crumbInfo,k){if(self.addedNames.indexOf(crumbInfo.name)!==-1){crumbInfo.name+=' hidden-crumb';}else{self.addedNames.push(crumbInfo.name);}});}}});return $.mage.breadcrumbs;};});