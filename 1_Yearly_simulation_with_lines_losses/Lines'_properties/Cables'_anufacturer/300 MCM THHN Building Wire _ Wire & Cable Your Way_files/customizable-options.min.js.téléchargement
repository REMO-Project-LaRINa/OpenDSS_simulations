define(['jquery','!domReady'],function($){'use strict';$.widget('default.footSpool',{_create:function(){this._init();this._bind();},_init:function(){this.options.productOptionsElement=$('.product-options-wrapper');this.options.productTypeSwitchElement=$('.product-type-switch');this.options.minMaxElement=$('.min-max');this.options.footOptions=$('.by-ft-spool');this.options.footColorOptions=$('.by-ft-spool-color');this.options.quantityField=$('.field.qty');this.options.addOptionButton=$('#add-length-button');this.options.quantityInputs=$('.label-qty input');this.options.spoolCheckboxSelector='.by-ft-spool .field.choice';this.options.footColorsWrapperClass='foot-colors-wrapper';},_bind:function(){var defaultFtColorsNumber=this.options.footOptions.length?$(this.options.spoolCheckboxSelector+' input[type="checkbox"]').length:0;this.options.optionsCount=this.options.footColorOptions.length?this.options.footColorOptions.length:defaultFtColorsNumber;this.options.currentVisibleOptionsCount=this.options.visibleOptionsCount;this.options.visibleOptionsCount=this.options.visibleOptionsCount?this.options.visibleOptionsCount:this.options.optionsCount;this.moveFootColorOptions();this.moveMinMaxElement();this.bindSpoolCheckboxListener();this.bindAddOptionListener();this.bindTypeSwitcherListener();this.checkFirstLength();this.hideFootProductFields();this.hideSpoolProductFields();this.showElements();},showElements:function(){$.each($(this.options.spoolCheckboxSelector+' input[type="checkbox"]'),function(key,element){$(element).parent().find('select').prop('disabled',!$(element).is(':checked'));$(element).parent().find('input[type="number"]').prop('disabled',!$(element).is(':checked'));});this.options.productOptionsElement.show();},moveFootColorOptions:function(){var self=this;self.options.footColorOptions.each(function(i){var childNumber=i+1;$(this).detach().appendTo($(self.options.spoolCheckboxSelector+':nth-child('+childNumber+')'));$(this).find('select').prop('disabled',true);});},moveMinMaxElement:function(){var self=this;if(self.options.footOptions.length){self.options.minMaxElement.insertBefore(self.options.footOptions);}},hideFootProductFields:function(){var self=this;if(self.options.footOptions.length){$('<div class="cut-to-length">Cut to Length - Sold By The Foot</div>').appendTo('.product.attribute.sku');self.options.quantityField.css('display','none');if(self.options.optionsCount===0||self.options.optionsCount===self.options.visibleOptionsCount){self.options.addOptionButton.addClass('hidden');}else{for(var i=1;i<=self.options.optionsCount;i++){var qtyInput=self.options.quantityInputs[i-1];if(parseInt(qtyInput.value)===0&&i>self.options.visibleOptionsCount){$(self.options.spoolCheckboxSelector+':nth-child('+i+')').addClass('hidden');}}}
var isTypeSelectorExists=self.options.productTypeSwitchElement.find('.field.choice:first-of-type .radio').length,isFootSelected=self.options.productTypeSwitchElement.find('.field.choice:first-of-type .radio').is(':checked');if(isTypeSelectorExists&&!isFootSelected){$.each($(self.options.spoolCheckboxSelector+' input[type="checkbox"]:checked'),function(key,checkbox){$(checkbox).parent().find('select').attr('disabled',true);$(checkbox).attr('checked',false)});}}},hideSpoolProductFields:function(){var self=this;if(!self.options.footOptions.length){self.options.addOptionButton.css('display','none');self.options.minMaxElement.css('display','none');}},checkFirstLength:function(){if($(this.options.spoolCheckboxSelector+' input[type="checkbox"]').length>0){var element=$(this.options.spoolCheckboxSelector+' input[type="checkbox"]')[0];if(!$(element).is(':checked')){var qtyInput=$(element).parent().find('.qty.mageworx-option-qty');$(element).click();qtyInput.prop('disabled',false);qtyInput.val(1);}else{var colorValue=$(element).parent().find('select option:selected').text();$.each($(this.options.spoolCheckboxSelector+' input[type="checkbox"]:checked'),function(key,checkbox){$(checkbox).parent().find('select option').filter(function(){return $(this).html()===colorValue;}).attr('selected','selected');});}}},bindSpoolCheckboxListener:function(){var self=this;$(self.options.spoolCheckboxSelector).find('input[type="checkbox"]').on('change',function(){$(this).parent().find('select').prop('disabled',!$(this).is(':checked'));$(this).parent().find('.label-qty').toggleClass('active',$(this).is(':checked'));})},bindAddOptionListener:function(){var self=this;self.options.addOptionButton.on('click',function(){self.options.currentVisibleOptionsCount++;$(self.options.spoolCheckboxSelector+':nth-child('+self.options.currentVisibleOptionsCount+')').removeClass('hidden').css('display','flex');if(self.options.currentVisibleOptionsCount===self.options.optionsCount){self.options.addOptionButton.addClass('hidden');}})},bindTypeSwitcherListener:function(){var self=this;this.options.productTypeSwitchElement.find('input[type=radio]').change(function(){if(self.options.productTypeSwitchElement.find('.field.choice:first-of-type .radio').is(':checked')){self.options.quantityField.css('display','none');self.options.addOptionButton.css('display','inline');self.options.minMaxElement.css('display','block');self.checkFirstLength();}else{self.options.quantityField.css('display','table-cell');self.options.addOptionButton.css('display','none');self.options.minMaxElement.css('display','none');}});}});return $.default.footSpool;});